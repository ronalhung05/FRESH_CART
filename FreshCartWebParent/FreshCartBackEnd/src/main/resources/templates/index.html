<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:replace="fragments :: page_head('Home - FreshCart Admin', 'none')" />

<body>
	<div th:replace="navigation :: top_nav"></div>

	<div class="main-wrapper">
		<div th:replace="navigation :: menu"></div>
		
		<!-- main content -->
		<main class="main-content-wrapper bg-white">
			<section class="container">
				<!-- Welcome Banner -->
				<div class="row mb-8">
					<div class="col-md-12">
						<div class="card bg-light border-0 rounded-4"
							style="background-image: url(images/slider/slider-image-1.jpg); background-repeat: no-repeat; background-size: cover; background-position: right;">
							<div class="card-body p-lg-12">
								<h1>Welcome back! FreshCart</h1>
								<p>FreshCart Admin Control Panel</p>
								<a th:href="@{/products/new}" class="btn btn-primary">Create Product</a>
							</div>
						</div>
					</div>
				</div>

				<!-- Statistics Cards -->
				<div class="row">
					<!-- Earnings Card -->
					<div class="col-lg-4 col-12 mb-6">
						<div class="card h-100 card-lg">
							<div class="card-body p-6">
								<div class="d-flex justify-content-between align-items-center mb-6">
									<div>
										<h4 class="mb-0 fs-5">Earnings</h4>
									</div>
									<div class="icon-shape icon-md bg-light-danger text-dark-danger rounded-circle">
										<i class="bi bi-currency-dollar fs-5"></i>
									</div>
								</div>
								<div class="lh-1">
									<h1 class="mb-2 fw-bold fs-2">$93,438.78</h1>
									<span>Monthly revenue</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Orders Card -->
					<div class="col-lg-4 col-12 mb-6">
						<div class="card h-100 card-lg">
							<div class="card-body p-6">
								<div class="d-flex justify-content-between align-items-center mb-6">
									<div>
										<h4 class="mb-0 fs-5">Orders</h4>
									</div>
									<div class="icon-shape icon-md bg-light-warning text-dark-warning rounded-circle">
										<i class="bi bi-cart fs-5"></i>
									</div>
								</div>
								<div class="lh-1">
									<h1 class="mb-2 fw-bold fs-2">42,339</h1>
									<span>Total orders</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Customers Card -->
					<div class="col-lg-4 col-12 mb-6">
						<div class="card h-100 card-lg">
							<div class="card-body p-6">
								<div class="d-flex justify-content-between align-items-center mb-6">
									<div>
										<h4 class="mb-0 fs-5">Customers</h4>
									</div>
									<div class="icon-shape icon-md bg-light-info text-dark-info rounded-circle">
										<i class="bi bi-people fs-5"></i>
									</div>
								</div>
								<div class="lh-1">
									<h1 class="mb-2 fw-bold fs-2">39,354</h1>
									<span>Total customers</span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row ">
					<div class="col-xl-8 col-lg-6 col-md-12 col-12 mb-6">
						<!-- card -->
						<div class="card h-100 card-lg">
							<div class="card-body p-6">
								<!-- heading -->
								<div class="d-flex justify-content-between">
									<div>
										<h3 class="mb-1 fs-5">Revenue </h3>
										<small>(+63%) than last year)</small>
									</div>
									<div>
										<!-- select option -->
										<select class="form-select ">
											<option selected>2019</option>
											<option value="2023">2020</option>
											<option value="2024">2021</option>
											<option value="2025">2022</option>
											<option value="2025">2023</option>
										</select>
									</div>

								</div>
								<!-- chart -->
								<div id="revenueChart" class="mt-6"></div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-6 col-12 mb-6">
						<!-- card -->
						<div class="card h-100 card-lg">
							<!-- card body -->
							<div class="card-body p-6">
								<!-- heading -->
								<h3 class="mb-0 fs-5">Total Sales </h3>
								<div id="totalSale" class="mt-6 d-flex justify-content-center"></div>
								<div class="mt-4">
									<!-- list -->
									<ul class="list-unstyled mb-0">
										<li class="mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="8"
												height="8" fill="currentColor"
												class="bi bi-circle-fill text-primary" viewBox="0 0 16 16">
												<circle cx="8" cy="8" r="8" />
											</svg> <span class="ms-1"><span class="text-dark">Shippings
													$32.98</span> (2%)</span></li>
										<li class="mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="8"
												height="8" fill="currentColor"
												class="bi bi-circle-fill text-warning" viewBox="0 0 16 16">
												<circle cx="8" cy="8" r="8" />
											</svg> <span class="ms-1"><span class="text-dark">Refunds $11</span>
												(11%)</span></li>
										<li class="mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="8"
												height="8" fill="currentColor" class="bi bi-circle-fill text-danger"
												viewBox="0 0 16 16">
												<circle cx="8" cy="8" r="8" />
											</svg> <span class="ms-1"><span class="text-dark">Order $14.87</span>
												(1%)</span></li>
										<li><svg xmlns="http://www.w3.org/2000/svg" width="8" height="8"
												fill="currentColor" class="bi bi-circle-fill text-info"
												viewBox="0 0 16 16">
												<circle cx="8" cy="8" r="8" />
											</svg> <span class="ms-1"><span class="text-dark">Income 3,271</span>
												(86%)</span></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Recent Orders Table -->
				<div class="row">
					<div class="col-lg-12 col-12 mb-6">
						<div class="card h-100 card-lg">
							<div class="p-6">
								<h3 class="mb-0 fs-5">Recent Order</h3>
							 </div>
							<div class="card-body p-0">
								<div class="table-responsive">
									<table class="table table-centered table-borderless text-nowrap table-hover">
										<thead class="table-light">
											<tr>
												<th>Order ID</th>
												<th>Customer</th>
												<th>Date</th>
												<th>Amount</th>
												<th>Status</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="order : ${listRecentOrders}">
												<td th:text="${'#' + order.id}"></td>
												<td th:text="${order.customer.fullName}"></td>
												<td th:text="${#dates.format(order.orderTime, 'dd MMM yyyy')}"></td>
												<td>
													<div th:replace="fragments :: format_currency(${order.total})"></div>
												</td>
												<td>
													<span th:class="${'badge ' + 
														(order.status.toString() == 'NEW' ? 'badge bg-light-info text-dark-info' : 
														(order.status.toString() == 'PROCESSING' ? 'badge bg-light-warning text-dark-warning' : 
														(order.status.toString() == 'DELIVERED' ? 'badge bg-light-success text-dark-success' : 
														(order.status.toString() == 'CANCELLED' ? 'bg-danger' : ' badge bg-light-secondary text-dark-secondary'))))}">
														[[${order.status}]]
													</span>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</main>

	</div>
	<div th:replace="fragments :: footer"></div>
	<div th:replace="fragments :: common-js"></div>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		var contextPath = "[[@{/}]]";
		$(document).ready(function() {
			google.charts.load('current', {
				'packages': ['corechart']
			});
			google.charts.setOnLoadCallback(function() {
				loadRevenueChart('2019'); // Load initial chart for 2019
			});

			// Event handler for year selection
			$('.form-select').change(function() {
				var selectedYear = $(this).val();
				loadRevenueChart(selectedYear);
			});
		});

		function loadRevenueChart(year) {
			var requestURL = contextPath + "reports/revenue_by_year/" + year;
			
			$.get(requestURL, function(responseJSON) {
				var data = new google.visualization.DataTable();
				data.addColumn('string', 'Month');
				data.addColumn('number', 'Revenue');

				responseJSON.forEach(function(reportItem) {
					data.addRow([reportItem.month, reportItem.revenue]);
				});

				var options = {
					title: 'Revenue for ' + year,
					height: 360,
					legend: { position: 'top' },
					hAxis: { title: 'Month' },
					vAxis: { title: 'Revenue', format: 'currency' },
					series: { 0: { type: 'area' } }
				};

				var chart = new google.visualization.AreaChart(document.getElementById('revenueChart'));
				chart.draw(data, options);
			});
		}
	</script>
</body>

</html>